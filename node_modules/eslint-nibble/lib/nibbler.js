'use strict';

var _require = require('eslint'),
    CLIEngine = _require.CLIEngine;

var cli = new CLIEngine({});

function getCounts(messages) {
  var counts = messages.reduce(function (result, message) {
    if (message.severity === 1) {
      result.warningCount++;
      if (message.fix) {
        result.fixableWarningCount++;
      }
    }
    if (message.severity === 2) {
      result.errorCount++;
      if (message.fix) {
        result.fixableErrorCount++;
      }
    }
    return result;
  }, { errorCount: 0, warningCount: 0, fixableErrorCount: 0, fixableWarningCount: 0 });

  return counts;
}

/**
 * Get only the results wanted from a report
 * @param  {object} report   The report to filter
 * @param  {string} msgKey   Name of the message property on which to filter
 * @param  {object} options  Options to use for comparison
 * @return {object}          Report object which only contains messages that pass filter
 */
function filterResults(report, msgKey, options) {
  var newResults = {};
  var totalErrors = 0;
  var totalWarnings = 0;
  var totalFixableErrors = 0;
  var totalFixableWarnings = 0;
  newResults.results = report.results.map(function (result) {
    var filteredMessages = result.messages.filter(function (msg) {
      if (options.present) {
        return msg[msgKey];
      }
      if (options.compareVal) {
        return msg[msgKey] === options.compareVal;
      }
      return false;
    });
    if (filteredMessages) {
      var _getCounts = getCounts(filteredMessages),
          errorCount = _getCounts.errorCount,
          warningCount = _getCounts.warningCount,
          fixableErrorCount = _getCounts.fixableErrorCount,
          fixableWarningCount = _getCounts.fixableWarningCount;

      totalErrors += errorCount;
      totalWarnings += warningCount;
      totalFixableErrors += fixableErrorCount;
      totalFixableWarnings += fixableWarningCount;
      // fixableErrors += fixableErrors;
      return {
        filePath: result.filePath,
        messages: filteredMessages,

        errorCount: errorCount,
        warningCount: warningCount,
        fixableErrorCount: fixableErrorCount,
        fixableWarningCount: fixableWarningCount
      };
    }
    return {};
  });
  newResults.errorCount = totalErrors;
  newResults.warningCount = totalWarnings;
  newResults.fixableErrorCount = totalFixableErrors;
  newResults.fixableWarningCount = totalFixableWarnings;
  return newResults;
}

module.exports = {
  configure: function configure(configuration) {
    cli = new CLIEngine(configuration);
  },
  nibbleOnFiles: function nibbleOnFiles(files) {
    var report = cli.executeOnFiles(files);
    return report;
  },
  getFatalResults: function getFatalResults(report) {
    var fatalResults = filterResults(report, 'fatal', { present: true });
    if (fatalResults.errorCount > 0) {
      return fatalResults;
    }
    return undefined;
  },
  getFormattedResults: function getFormattedResults(report, fmt) {
    var formatter = cli.getFormatter(fmt);
    return formatter(report.results);
  },
  getRuleResults: function getRuleResults(report, ruleName) {
    var ruleResults = filterResults(report, 'ruleId', { compareVal: ruleName });
    return ruleResults;
  },
  getSeverityResults: function getSeverityResults(report, severity) {
    var ruleResults = filterResults(report, 'severity', { compareVal: severity });
    return ruleResults;
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9uaWJibGVyLmpzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJDTElFbmdpbmUiLCJjbGkiLCJnZXRDb3VudHMiLCJtZXNzYWdlcyIsImNvdW50cyIsInJlZHVjZSIsInJlc3VsdCIsIm1lc3NhZ2UiLCJzZXZlcml0eSIsIndhcm5pbmdDb3VudCIsImZpeCIsImZpeGFibGVXYXJuaW5nQ291bnQiLCJlcnJvckNvdW50IiwiZml4YWJsZUVycm9yQ291bnQiLCJmaWx0ZXJSZXN1bHRzIiwicmVwb3J0IiwibXNnS2V5Iiwib3B0aW9ucyIsIm5ld1Jlc3VsdHMiLCJ0b3RhbEVycm9ycyIsInRvdGFsV2FybmluZ3MiLCJ0b3RhbEZpeGFibGVFcnJvcnMiLCJ0b3RhbEZpeGFibGVXYXJuaW5ncyIsInJlc3VsdHMiLCJtYXAiLCJmaWx0ZXJlZE1lc3NhZ2VzIiwiZmlsdGVyIiwibXNnIiwicHJlc2VudCIsImNvbXBhcmVWYWwiLCJmaWxlUGF0aCIsIm1vZHVsZSIsImV4cG9ydHMiLCJjb25maWd1cmUiLCJjb25maWd1cmF0aW9uIiwibmliYmxlT25GaWxlcyIsImZpbGVzIiwiZXhlY3V0ZU9uRmlsZXMiLCJnZXRGYXRhbFJlc3VsdHMiLCJmYXRhbFJlc3VsdHMiLCJ1bmRlZmluZWQiLCJnZXRGb3JtYXR0ZWRSZXN1bHRzIiwiZm10IiwiZm9ybWF0dGVyIiwiZ2V0Rm9ybWF0dGVyIiwiZ2V0UnVsZVJlc3VsdHMiLCJydWxlTmFtZSIsInJ1bGVSZXN1bHRzIiwiZ2V0U2V2ZXJpdHlSZXN1bHRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7ZUFFc0JBLFFBQVEsUUFBUixDO0lBQWRDLFMsWUFBQUEsUzs7QUFDUixJQUFJQyxNQUFNLElBQUlELFNBQUosQ0FBYyxFQUFkLENBQVY7O0FBRUEsU0FBU0UsU0FBVCxDQUFtQkMsUUFBbkIsRUFBNkI7QUFDM0IsTUFBSUMsU0FBU0QsU0FBU0UsTUFBVCxDQUFnQixVQUFVQyxNQUFWLEVBQWtCQyxPQUFsQixFQUEyQjtBQUN0RCxRQUFJQSxRQUFRQyxRQUFSLEtBQXFCLENBQXpCLEVBQTRCO0FBQzFCRixhQUFPRyxZQUFQO0FBQ0EsVUFBSUYsUUFBUUcsR0FBWixFQUFpQjtBQUNmSixlQUFPSyxtQkFBUDtBQUNEO0FBQ0Y7QUFDRCxRQUFJSixRQUFRQyxRQUFSLEtBQXFCLENBQXpCLEVBQTRCO0FBQzFCRixhQUFPTSxVQUFQO0FBQ0EsVUFBSUwsUUFBUUcsR0FBWixFQUFpQjtBQUNmSixlQUFPTyxpQkFBUDtBQUNEO0FBQ0Y7QUFDRCxXQUFPUCxNQUFQO0FBQ0QsR0FkWSxFQWNWLEVBQUVNLFlBQVksQ0FBZCxFQUFpQkgsY0FBYyxDQUEvQixFQUFrQ0ksbUJBQW1CLENBQXJELEVBQXdERixxQkFBcUIsQ0FBN0UsRUFkVSxDQUFiOztBQWdCQSxTQUFPUCxNQUFQO0FBQ0Q7O0FBRUQ7Ozs7Ozs7QUFPQSxTQUFTVSxhQUFULENBQXVCQyxNQUF2QixFQUErQkMsTUFBL0IsRUFBdUNDLE9BQXZDLEVBQWdEO0FBQzlDLE1BQUlDLGFBQWEsRUFBakI7QUFDQSxNQUFJQyxjQUFjLENBQWxCO0FBQ0EsTUFBSUMsZ0JBQWdCLENBQXBCO0FBQ0EsTUFBSUMscUJBQXFCLENBQXpCO0FBQ0EsTUFBSUMsdUJBQXVCLENBQTNCO0FBQ0FKLGFBQVdLLE9BQVgsR0FBcUJSLE9BQU9RLE9BQVAsQ0FBZUMsR0FBZixDQUFtQixVQUFVbEIsTUFBVixFQUFrQjtBQUN4RCxRQUFJbUIsbUJBQW1CbkIsT0FBT0gsUUFBUCxDQUFnQnVCLE1BQWhCLENBQXVCLFVBQVVDLEdBQVYsRUFBZTtBQUMzRCxVQUFJVixRQUFRVyxPQUFaLEVBQXFCO0FBQ25CLGVBQVFELElBQUlYLE1BQUosQ0FBUjtBQUNEO0FBQ0QsVUFBSUMsUUFBUVksVUFBWixFQUF3QjtBQUN0QixlQUFRRixJQUFJWCxNQUFKLE1BQWdCQyxRQUFRWSxVQUFoQztBQUNEO0FBQ0QsYUFBTyxLQUFQO0FBQ0QsS0FSc0IsQ0FBdkI7QUFTQSxRQUFJSixnQkFBSixFQUFzQjtBQUFBLHVCQUN1RHZCLFVBQVV1QixnQkFBVixDQUR2RDtBQUFBLFVBQ2RiLFVBRGMsY0FDZEEsVUFEYztBQUFBLFVBQ0ZILFlBREUsY0FDRkEsWUFERTtBQUFBLFVBQ1lJLGlCQURaLGNBQ1lBLGlCQURaO0FBQUEsVUFDK0JGLG1CQUQvQixjQUMrQkEsbUJBRC9COztBQUVwQlEscUJBQWVQLFVBQWY7QUFDQVEsdUJBQWlCWCxZQUFqQjtBQUNBWSw0QkFBc0JSLGlCQUF0QjtBQUNBUyw4QkFBd0JYLG1CQUF4QjtBQUNBO0FBQ0EsYUFBTztBQUNMbUIsa0JBQVV4QixPQUFPd0IsUUFEWjtBQUVMM0Isa0JBQVVzQixnQkFGTDs7QUFJTGIsOEJBSks7QUFLTEgsa0NBTEs7QUFNTEksNENBTks7QUFPTEY7QUFQSyxPQUFQO0FBU0Q7QUFDRCxXQUFPLEVBQVA7QUFDRCxHQTVCb0IsQ0FBckI7QUE2QkFPLGFBQVdOLFVBQVgsR0FBd0JPLFdBQXhCO0FBQ0FELGFBQVdULFlBQVgsR0FBMEJXLGFBQTFCO0FBQ0FGLGFBQVdMLGlCQUFYLEdBQStCUSxrQkFBL0I7QUFDQUgsYUFBV1AsbUJBQVgsR0FBaUNXLG9CQUFqQztBQUNBLFNBQU9KLFVBQVA7QUFDRDs7QUFFRGEsT0FBT0MsT0FBUCxHQUFpQjtBQUVmQyxXQUZlLHFCQUVMQyxhQUZLLEVBRVU7QUFDdkJqQyxVQUFNLElBQUlELFNBQUosQ0FBY2tDLGFBQWQsQ0FBTjtBQUNELEdBSmM7QUFNZkMsZUFOZSx5QkFNREMsS0FOQyxFQU1NO0FBQ25CLFFBQUlyQixTQUFTZCxJQUFJb0MsY0FBSixDQUFtQkQsS0FBbkIsQ0FBYjtBQUNBLFdBQU9yQixNQUFQO0FBQ0QsR0FUYztBQVdmdUIsaUJBWGUsMkJBV0N2QixNQVhELEVBV1M7QUFDdEIsUUFBSXdCLGVBQWV6QixjQUFjQyxNQUFkLEVBQXNCLE9BQXRCLEVBQStCLEVBQUVhLFNBQVMsSUFBWCxFQUEvQixDQUFuQjtBQUNBLFFBQUlXLGFBQWEzQixVQUFiLEdBQTBCLENBQTlCLEVBQWlDO0FBQy9CLGFBQU8yQixZQUFQO0FBQ0Q7QUFDRCxXQUFPQyxTQUFQO0FBQ0QsR0FqQmM7QUFtQmZDLHFCQW5CZSwrQkFtQksxQixNQW5CTCxFQW1CYTJCLEdBbkJiLEVBbUJrQjtBQUMvQixRQUFJQyxZQUFZMUMsSUFBSTJDLFlBQUosQ0FBaUJGLEdBQWpCLENBQWhCO0FBQ0EsV0FBT0MsVUFBVTVCLE9BQU9RLE9BQWpCLENBQVA7QUFDRCxHQXRCYztBQXdCZnNCLGdCQXhCZSwwQkF3QkE5QixNQXhCQSxFQXdCUStCLFFBeEJSLEVBd0JrQjtBQUMvQixRQUFJQyxjQUFjakMsY0FBY0MsTUFBZCxFQUFzQixRQUF0QixFQUFnQyxFQUFFYyxZQUFZaUIsUUFBZCxFQUFoQyxDQUFsQjtBQUNBLFdBQU9DLFdBQVA7QUFDRCxHQTNCYztBQTZCZkMsb0JBN0JlLDhCQTZCSWpDLE1BN0JKLEVBNkJZUCxRQTdCWixFQTZCc0I7QUFDbkMsUUFBSXVDLGNBQWNqQyxjQUFjQyxNQUFkLEVBQXNCLFVBQXRCLEVBQWtDLEVBQUVjLFlBQVlyQixRQUFkLEVBQWxDLENBQWxCO0FBQ0EsV0FBT3VDLFdBQVA7QUFDRDtBQWhDYyxDQUFqQiIsImZpbGUiOiJuaWJibGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCB7IENMSUVuZ2luZSB9ID0gcmVxdWlyZSgnZXNsaW50Jyk7XG5sZXQgY2xpID0gbmV3IENMSUVuZ2luZSh7fSk7XG5cbmZ1bmN0aW9uIGdldENvdW50cyhtZXNzYWdlcykge1xuICBsZXQgY291bnRzID0gbWVzc2FnZXMucmVkdWNlKGZ1bmN0aW9uIChyZXN1bHQsIG1lc3NhZ2UpIHtcbiAgICBpZiAobWVzc2FnZS5zZXZlcml0eSA9PT0gMSkge1xuICAgICAgcmVzdWx0Lndhcm5pbmdDb3VudCsrO1xuICAgICAgaWYgKG1lc3NhZ2UuZml4KSB7XG4gICAgICAgIHJlc3VsdC5maXhhYmxlV2FybmluZ0NvdW50Kys7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChtZXNzYWdlLnNldmVyaXR5ID09PSAyKSB7XG4gICAgICByZXN1bHQuZXJyb3JDb3VudCsrO1xuICAgICAgaWYgKG1lc3NhZ2UuZml4KSB7XG4gICAgICAgIHJlc3VsdC5maXhhYmxlRXJyb3JDb3VudCsrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LCB7IGVycm9yQ291bnQ6IDAsIHdhcm5pbmdDb3VudDogMCwgZml4YWJsZUVycm9yQ291bnQ6IDAsIGZpeGFibGVXYXJuaW5nQ291bnQ6IDAgfSk7XG5cbiAgcmV0dXJuIGNvdW50cztcbn1cblxuLyoqXG4gKiBHZXQgb25seSB0aGUgcmVzdWx0cyB3YW50ZWQgZnJvbSBhIHJlcG9ydFxuICogQHBhcmFtICB7b2JqZWN0fSByZXBvcnQgICBUaGUgcmVwb3J0IHRvIGZpbHRlclxuICogQHBhcmFtICB7c3RyaW5nfSBtc2dLZXkgICBOYW1lIG9mIHRoZSBtZXNzYWdlIHByb3BlcnR5IG9uIHdoaWNoIHRvIGZpbHRlclxuICogQHBhcmFtICB7b2JqZWN0fSBvcHRpb25zICBPcHRpb25zIHRvIHVzZSBmb3IgY29tcGFyaXNvblxuICogQHJldHVybiB7b2JqZWN0fSAgICAgICAgICBSZXBvcnQgb2JqZWN0IHdoaWNoIG9ubHkgY29udGFpbnMgbWVzc2FnZXMgdGhhdCBwYXNzIGZpbHRlclxuICovXG5mdW5jdGlvbiBmaWx0ZXJSZXN1bHRzKHJlcG9ydCwgbXNnS2V5LCBvcHRpb25zKSB7XG4gIGxldCBuZXdSZXN1bHRzID0ge307XG4gIGxldCB0b3RhbEVycm9ycyA9IDA7XG4gIGxldCB0b3RhbFdhcm5pbmdzID0gMDtcbiAgbGV0IHRvdGFsRml4YWJsZUVycm9ycyA9IDA7XG4gIGxldCB0b3RhbEZpeGFibGVXYXJuaW5ncyA9IDA7XG4gIG5ld1Jlc3VsdHMucmVzdWx0cyA9IHJlcG9ydC5yZXN1bHRzLm1hcChmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgbGV0IGZpbHRlcmVkTWVzc2FnZXMgPSByZXN1bHQubWVzc2FnZXMuZmlsdGVyKGZ1bmN0aW9uIChtc2cpIHtcbiAgICAgIGlmIChvcHRpb25zLnByZXNlbnQpIHtcbiAgICAgICAgcmV0dXJuIChtc2dbbXNnS2V5XSk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5jb21wYXJlVmFsKSB7XG4gICAgICAgIHJldHVybiAobXNnW21zZ0tleV0gPT09IG9wdGlvbnMuY29tcGFyZVZhbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgaWYgKGZpbHRlcmVkTWVzc2FnZXMpIHtcbiAgICAgIGxldCB7IGVycm9yQ291bnQsIHdhcm5pbmdDb3VudCwgZml4YWJsZUVycm9yQ291bnQsIGZpeGFibGVXYXJuaW5nQ291bnQgfSA9IGdldENvdW50cyhmaWx0ZXJlZE1lc3NhZ2VzKTtcbiAgICAgIHRvdGFsRXJyb3JzICs9IGVycm9yQ291bnQ7XG4gICAgICB0b3RhbFdhcm5pbmdzICs9IHdhcm5pbmdDb3VudDtcbiAgICAgIHRvdGFsRml4YWJsZUVycm9ycyArPSBmaXhhYmxlRXJyb3JDb3VudDtcbiAgICAgIHRvdGFsRml4YWJsZVdhcm5pbmdzICs9IGZpeGFibGVXYXJuaW5nQ291bnQ7XG4gICAgICAvLyBmaXhhYmxlRXJyb3JzICs9IGZpeGFibGVFcnJvcnM7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmaWxlUGF0aDogcmVzdWx0LmZpbGVQYXRoLFxuICAgICAgICBtZXNzYWdlczogZmlsdGVyZWRNZXNzYWdlcyxcblxuICAgICAgICBlcnJvckNvdW50LFxuICAgICAgICB3YXJuaW5nQ291bnQsXG4gICAgICAgIGZpeGFibGVFcnJvckNvdW50LFxuICAgICAgICBmaXhhYmxlV2FybmluZ0NvdW50XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge307XG4gIH0pO1xuICBuZXdSZXN1bHRzLmVycm9yQ291bnQgPSB0b3RhbEVycm9ycztcbiAgbmV3UmVzdWx0cy53YXJuaW5nQ291bnQgPSB0b3RhbFdhcm5pbmdzO1xuICBuZXdSZXN1bHRzLmZpeGFibGVFcnJvckNvdW50ID0gdG90YWxGaXhhYmxlRXJyb3JzO1xuICBuZXdSZXN1bHRzLmZpeGFibGVXYXJuaW5nQ291bnQgPSB0b3RhbEZpeGFibGVXYXJuaW5ncztcbiAgcmV0dXJuIG5ld1Jlc3VsdHM7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gIGNvbmZpZ3VyZShjb25maWd1cmF0aW9uKSB7XG4gICAgY2xpID0gbmV3IENMSUVuZ2luZShjb25maWd1cmF0aW9uKTtcbiAgfSxcblxuICBuaWJibGVPbkZpbGVzKGZpbGVzKSB7XG4gICAgbGV0IHJlcG9ydCA9IGNsaS5leGVjdXRlT25GaWxlcyhmaWxlcyk7XG4gICAgcmV0dXJuIHJlcG9ydDtcbiAgfSxcblxuICBnZXRGYXRhbFJlc3VsdHMocmVwb3J0KSB7XG4gICAgbGV0IGZhdGFsUmVzdWx0cyA9IGZpbHRlclJlc3VsdHMocmVwb3J0LCAnZmF0YWwnLCB7IHByZXNlbnQ6IHRydWUgfSk7XG4gICAgaWYgKGZhdGFsUmVzdWx0cy5lcnJvckNvdW50ID4gMCkge1xuICAgICAgcmV0dXJuIGZhdGFsUmVzdWx0cztcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSxcblxuICBnZXRGb3JtYXR0ZWRSZXN1bHRzKHJlcG9ydCwgZm10KSB7XG4gICAgbGV0IGZvcm1hdHRlciA9IGNsaS5nZXRGb3JtYXR0ZXIoZm10KTtcbiAgICByZXR1cm4gZm9ybWF0dGVyKHJlcG9ydC5yZXN1bHRzKTtcbiAgfSxcblxuICBnZXRSdWxlUmVzdWx0cyhyZXBvcnQsIHJ1bGVOYW1lKSB7XG4gICAgbGV0IHJ1bGVSZXN1bHRzID0gZmlsdGVyUmVzdWx0cyhyZXBvcnQsICdydWxlSWQnLCB7IGNvbXBhcmVWYWw6IHJ1bGVOYW1lIH0pO1xuICAgIHJldHVybiBydWxlUmVzdWx0cztcbiAgfSxcblxuICBnZXRTZXZlcml0eVJlc3VsdHMocmVwb3J0LCBzZXZlcml0eSkge1xuICAgIGxldCBydWxlUmVzdWx0cyA9IGZpbHRlclJlc3VsdHMocmVwb3J0LCAnc2V2ZXJpdHknLCB7IGNvbXBhcmVWYWw6IHNldmVyaXR5IH0pO1xuICAgIHJldHVybiBydWxlUmVzdWx0cztcbiAgfVxufTtcbiJdfQ==